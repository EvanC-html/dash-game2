<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Velocity Run</title>

<style>
html, body {
    margin: 0;
    padding: 0;
    background: #0b0b10;
    overflow: hidden;
}
canvas {
    display: block;
    margin: auto;
    background: #111;
}
</style>
</head>
<body>

<canvas id="game"></canvas>

<script>
/* ===================== CONFIG ===================== */
const W = 900;
const H = 500;
const GRAVITY = 2800;
const JUMP_FORCE = 850;
const MAX_JUMP_HOLD = 0.22;
const PLAYER_SIZE = 32;
const GROUND_HEIGHT = 60;
const BASE_SPEED = 300;
const SPEED_INCREASE = 6;

/* ===================== CANVAS ===================== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = W;
canvas.height = H;

/* ===================== INPUT ===================== */
let jumpHeld = false;
let jumpPressed = false;

window.addEventListener("keydown", e => {
    if (e.code === "Space" || e.code === "ArrowUp") {
        if (!jumpHeld) jumpPressed = true;
        jumpHeld = true;
    }
});
window.addEventListener("keyup", e => {
    if (e.code === "Space" || e.code === "ArrowUp") {
        jumpHeld = false;
    }
});

/* ===================== STATE ===================== */
let state = "start";
let speed = BASE_SPEED;
let score = 0;

/* ===================== PLAYER ===================== */
const player = {
    x: 120,
    y: 0,
    vy: 0,
    grounded: false,
    jumpHold: 0
};

/* ===================== OBSTACLES ===================== */
let obstacles = [];
let spawnTimer = 0;

/* ===================== UTIL ===================== */
function rand(a,b){ return Math.random()*(b-a)+a; }

function rectHit(a,b){
    return a.x < b.x+b.w &&
           a.x+a.w > b.x &&
           a.y < b.y+b.h &&
           a.y+a.h > b.y;
}

function groundY(){ return H - GROUND_HEIGHT; }

/* ===================== RESET ===================== */
function resetGame(){
    state = "playing";
    speed = BASE_SPEED;
    score = 0;
    obstacles = [];
    spawnTimer = 0;
    player.y = 0;
    player.vy = 0;
    player.grounded = false;
}

/* ===================== UPDATE ===================== */
function update(dt){
    if(state !== "playing") return;

    speed += SPEED_INCREASE * dt;
    score += dt * speed * 0.02;

    // Jump
    if (jumpPressed && player.grounded) {
        player.vy = -JUMP_FORCE;
        player.jumpHold = MAX_JUMP_HOLD;
        player.grounded = false;
    }
    jumpPressed = false;

    if (jumpHeld && player.jumpHold > 0) {
        player.vy -= 1400 * dt;
        player.jumpHold -= dt;
    }

    // Physics
    player.vy += GRAVITY * dt;
    player.y += player.vy * dt;

    // Ground collision
    if (player.y + PLAYER_SIZE >= groundY()) {
        player.y = groundY() - PLAYER_SIZE;
        player.vy = 0;
        player.grounded = true;
        player.jumpHold = 0;
    }

    // Obstacles
    spawnTimer -= dt * speed;
    if (spawnTimer <= 0) {
        obstacles.push({
            x: W,
            y: groundY() - 30,
            w: 30,
            h: 30
        });
        spawnTimer = rand(260,420);
    }

    obstacles.forEach(o => o.x -= speed * dt);
    obstacles = obstacles.filter(o => o.x + o.w > 0);

    // Death
    for (let o of obstacles) {
        if (rectHit(player, o)) {
            state = "dead";
        }
    }
}

/* ===================== DRAW ===================== */
function draw(){
    ctx.clearRect(0,0,W,H);

    // Ground
    ctx.fillStyle = "#222";
    ctx.fillRect(0, groundY(), W, GROUND_HEIGHT);

    // Obstacles
    ctx.fillStyle = "#f55";
    obstacles.forEach(o=>{
        ctx.fillRect(o.x,o.y,o.w,o.h);
    });

    // Player
    ctx.fillStyle = "#fff";
    ctx.fillRect(player.x,player.y,PLAYER_SIZE,PLAYER_SIZE);

    ctx.fillStyle = "#fff";
    ctx.font = "20px Arial";

    if(state === "start"){
        ctx.textAlign = "center";
        ctx.fillText("PRESS SPACE TO START", W/2, H/2);
    }
    else if(state === "playing"){
        ctx.textAlign = "left";
        ctx.fillText("Score: " + Math.floor(score), 20, 30);
    }
    else if(state === "dead"){
        ctx.textAlign = "center";
        ctx.fillText("GAME OVER", W/2, H/2 - 20);
        ctx.fillText("PRESS SPACE TO RESTART", W/2, H/2 + 20);
    }
}

/* ===================== LOOP ===================== */
let last = 0;
function loop(t){
    const dt = Math.min((t - last) / 1000, 0.033);
    last = t;

    if(state === "start" && jumpPressed){
        jumpPressed = false;
        resetGame();
    }
    if(state === "dead" && jumpPressed){
        jumpPressed = false;
        resetGame();
    }

    update(dt);
    draw();
    requestAnimationFrame(loop);
}

requestAnimationFrame(loop);
</script>

</body>
</html>
