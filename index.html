<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Dash Velocity</title>
<style>
body{margin:0;background:black;overflow:hidden;font-family:Arial}
canvas{display:block;margin:auto;background:#111}

.menu{
 position:fixed;
 inset:0;
 background:rgba(0,0,0,.9);
 display:flex;
 align-items:center;
 justify-content:center;
 z-index:10;
}

.menuBox{
 background:#111;
 padding:24px;
 border-radius:14px;
 text-align:center;
 color:white;
 width:220px;
}

button{
 display:block;
 width:100%;
 margin:8px 0;
 padding:12px;
 font-size:16px;
 border:none;
 border-radius:8px;
}

button.locked{opacity:.4}
</style>
</head>
<body>

<canvas id="c"></canvas>

<div id="menu" class="menu">
 <div class="menuBox" id="menuBox"></div>
</div>

<script>
/* ============ SETUP ============ */
const canvas=document.getElementById("c");
const ctx=canvas.getContext("2d");

function resize(){
 canvas.width=innerWidth;
 canvas.height=innerHeight;
}
resize();
addEventListener("resize",resize);

let gravity=0.85;
let ground;
let baseSpeed, speed, levelLength, progress;
let gameOver=false, finished=false;

const player={
 x:120, y:0, s:30,
 vy:0, grounded:false
};

let obstacles=[], particles=[];
let level=1;
let unlocked=Number(localStorage.getItem("unlock")||1);

const levels=[
 {len:2200,spd:6},
 {len:2800,spd:7},
 {len:3400,spd:7.8},
 {len:4000,spd:8.5},
 {len:4600,spd:9.2}
];

/* ============ MENU ============ */
function buildMenu(){
 const box=document.getElementById("menuBox");
 box.innerHTML="<h2>Dash Velocity</h2>";

 levels.forEach((_,i)=>{
  const b=document.createElement("button");
  b.textContent="Level "+(i+1);
  if(i+1>unlocked){
   b.className="locked";
   b.disabled=true;
  }else{
   b.onclick=()=>startLevel(i+1);
  }
  box.appendChild(b);
 });
}
buildMenu();

/* ============ GAME FLOW ============ */
function startLevel(n){
 level=n;
 baseSpeed=levels[n-1].spd;
 speed=baseSpeed;
 levelLength=levels[n-1].len;
 document.getElementById("menu").style.display="none";
 reset();
}

function reset(){
 obstacles=[];
 particles=[];
 progress=0;
 gameOver=false;
 finished=false;

 ground=canvas.height*0.75;
 player.y=ground-player.s;
 player.vy=0;
 player.grounded=true;
}

/* ============ INPUT (ANTI-CHEAT) ============ */
let jumpPressed=false;

function pressJump(){
 if(jumpPressed) return; // prevents holding
 jumpPressed=true;

 if(finished) return;

 if(gameOver){
  reset();
  return;
 }

 if(player.grounded){
  player.vy=-14.5;
  player.grounded=false;
 }
}

function releaseJump(){
 jumpPressed=false;
}

addEventListener("touchstart",pressJump);
addEventListener("touchend",releaseJump);
addEventListener("keydown",e=>{
 if(e.code==="Space") pressJump();
});
addEventListener("keyup",e=>{
 if(e.code==="Space") releaseJump();
});

/* ============ SPAWNS ============ */
setInterval(()=>{
 if(gameOver||finished) return;
 obstacles.push({
  x:canvas.width,
  y:ground-30,
  w:30,h:30
 });
},850);

/* ============ PARTICLES ============ */
function spawnDeathParticles(){
 for(let i=0;i<28;i++){
  particles.push({
   x:player.x+15,
   y:player.y+15,
   vx:(Math.random()-0.5)*9,
   vy:(Math.random()-0.5)*9,
   life:45
  });
 }
}

/* ============ UPDATE ============ */
function update(){
 if(finished) return;

 if(gameOver){
  particles.forEach(p=>{
   p.x+=p.vx;
   p.y+=p.vy;
   p.vy+=0.25;
   p.life--;
  });
  particles=particles.filter(p=>p.life>0);
  return;
 }

 // gradual speed ramp (smoother pacing)
 speed+=0.0008;

 player.vy+=gravity;
 player.y+=player.vy;

 if(player.y>=ground-player.s){
  player.y=ground-player.s;
  player.vy=0;
  player.grounded=true;
 }

 obstacles.forEach(o=>{
  o.x-=speed;
  if(
   player.x<o.x+o.w &&
   player.x+player.s>o.x &&
   player.y<o.y+o.h &&
   player.y+player.s>o.y
  ){
   gameOver=true;
   spawnDeathParticles();
  }
 });

 obstacles=obstacles.filter(o=>o.x+o.w>0);

 progress+=speed;
 if(progress>=levelLength){
  finished=true;
  if(level===unlocked){
   unlocked++;
   localStorage.setItem("unlock",unlocked);
  }
  setTimeout(()=>{
   document.getElementById("menu").style.display="flex";
   buildMenu();
  },1100);
 }
}

/* ============ DRAW ============ */
function draw(){
 ctx.clearRect(0,0,canvas.width,canvas.height);

 ctx.fillStyle="#222";
 ctx.fillRect(0,ground,canvas.width,canvas.height-ground);

 if(!gameOver){
  ctx.fillStyle="cyan";
  ctx.fillRect(player.x,player.y,player.s,player.s);
 }

 ctx.fillStyle="white";
 obstacles.forEach(o=>ctx.fillRect(o.x,o.y,o.w,o.h));

 particles.forEach(p=>{
  ctx.fillStyle="orange";
  ctx.fillRect(p.x,p.y,4,4);
 });

 ctx.fillStyle="white";
 ctx.fillText("Level "+level,20,30);

 if(gameOver){
  ctx.font="30px Arial";
  ctx.fillText(
   "TAP TO RETRY",
   canvas.width/2-95,
   canvas.height/2
  );
 }

 if(finished){
  ctx.font="30px Arial";
  ctx.fillText(
   "LEVEL COMPLETE",
   canvas.width/2-140,
   canvas.height/2
  );
 }
}

/* ============ LOOP ============ */
function loop(){
 update();
 draw();
 requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
